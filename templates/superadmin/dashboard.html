{% extends "layout.html" %}

{% block title %}Super Admin Dashboard - QMS{% endblock %}

{% block header_button %}
<div class="flex gap-4">
    <a href="{{ url_for('superadmin_profile') }}" class="btn btn-ghost text-sm">My Profile</a>
    <a href="{{ url_for('logout') }}" class="btn btn-danger text-sm">Logout</a>
</div>
{% endblock %}

{% block content %}
<h2 class="text-3xl font-semibold mb-8 text-gray-100">Super Admin Dashboard</h2>

<div class="card p-8 mb-8">
    <h3 class="text-2xl font-semibold mb-5 text-white">Create New Event</h3>
    <form action="{{ url_for('superadmin_create_event') }}" method="POST">
        <div class="flex flex-col md:flex-row items-end gap-4">
            <div class="flex-grow w-full">
                <label for="event_name" class="block text-sm font-medium text-gray-300 mb-2">Event Name</label>
                <input type="text" id="event_name" name="event_name" class="w-full px-4 py-3 form-input"
                    placeholder="e.g., Spring Gala 2025" required>
            </div>
            <div class="flex-shrink-0 w-full md:w-auto">
                <button type="submit" class="w-full btn btn-cyber-green py-3">
                    Create Event
                </button>
            </div>
        </div>
    </form>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <div class="card p-8">
        <h3 class="text-2xl font-semibold mb-5 text-white">Pending Admin Approvals</h3>
        <div id="pending-admins-list" class="space-y-4 max-h-96 overflow-y-auto pr-2">
            {% if pending_admins %}
            {% for admin in pending_admins %}
            <div class="p-4 rounded-lg bg-gray-800/50 border border-gray-700 shadow-sm">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-lg font-semibold text-blue-300">{{ admin['name'] }}</span>
                    <span class="font-mono text-sm bg-gray-700 text-gray-200 px-2 py-0.5 rounded">{{ admin['username']
                        }}</span>
                </div>
                <div class="text-sm text-gray-300 space-y-1">
                    <p><strong>Phone:</strong> {{ admin['phone'] }}</p>
                    <p><strong>Address:</strong> {{ admin['address'] }}</p>
                </div>
                <div class="text-right mt-4">
                    <form action="{{ url_for('superadmin_approve_admin', username=admin['username']) }}" method="POST"
                        class="inline">
                        <button type="submit" class="btn btn-cyber-green text-sm">Approve</button>
                    </form>
                    <form action="{{ url_for('superadmin_delete_admin', username=admin['username']) }}" method="POST"
                        class="inline">
                        <button type="submit" class="btn btn-warning text-sm ml-2">Reject</button>
                    </form>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-gray-400">No pending approvals.</p>
            {% endif %}
        </div>
    </div>

    <div class="card p-8">
        <h3 class="text-2xl font-semibold mb-5 text-white">Manage Admins (Approved)</h3>
        <div id="approved-admins-list" class="space-y-4 max-h-96 overflow-y-auto pr-2">
            {% if approved_admins %}
            {% for admin in approved_admins %}
            <div class="flex items-center p-4 rounded-lg bg-gray-800/50 border border-gray-700 shadow-sm gap-4">
                {% if admin['profile_pic'] %}
                <img src="{{ url_for('uploaded_file', filename=admin['profile_pic']) }}"
                    class="w-16 h-16 rounded-full border-2 border-gray-600 flex-shrink-0 object-cover">
                {% else %}
                <span
                    class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 text-white flex items-center justify-center font-bold text-3xl border-2 border-white/50 shadow flex-shrink-0">{{
                    admin['name'][0].upper() if admin['name'] else 'A' }}</span>
                {% endif %}
                <div class="flex-grow">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-lg font-semibold text-blue-300">{{ admin['name'] }}</span>
                        <span class="font-mono text-sm bg-gray-700 text-gray-200 px-2 py-0.5 rounded">{{
                            admin['username'] }}</span>
                    </div>
                    <div class="text-sm text-gray-300 space-y-1">
                        <p><strong>Phone:</strong> {{ admin['phone'] }}</p>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <form action="{{ url_for('superadmin_delete_admin', username=admin['username']) }}" method="POST">
                        <button type="submit" class="btn btn-danger text-sm">Delete</button>
                    </form>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-gray-400">No approved admins found.</p>
            {% endif %}
        </div>
    </div>
</div>

<div class="card p-8 mt-8">
    <h3 class="text-2xl font-semibold mb-5 text-white">Manage All Events</h3>
    <div id="all-events-list" class="space-y-4">
        {% if all_events %}
        {% for event in all_events %}
        <div class="p-5 rounded-lg bg-gray-800/50 border border-gray-700 shadow-sm">
            <div class="flex flex-col md:flex-row justify-between items-center mb-2 gap-2">
                <span class="text-xl font-semibold text-blue-300">{{ event['event_name'] }}</span>
                <span class="text-sm text-gray-300">Admins: <b class="font-mono text-blue-300 text-base">{{
                        event['admin_count'] }}</b></span>
            </div>
            <div class="text-right mt-4 pt-4 border-t border-gray-700 flex flex-wrap justify-end gap-2">
                <a href="{{ url_for('view_logs', event_id=event['event_id']) }}" class="btn btn-green text-sm">View
                    Logs</a>
                <a href="{{ url_for('superadmin_manage_event_admins', event_id=event['event_id']) }}"
                    class="btn btn-purple text-sm">Manage Admins</a>
                <a href="{{ url_for('superadmin_edit_event_form', event_id=event['event_id']) }}"
                    class="btn btn-primary text-sm">Edit Form</a>
                <form action="{{ url_for('superadmin_delete_event', event_id=event['event_id']) }}" method="POST"
                    class="inline">
                    <button type="submit" class="btn btn-danger text-sm">Delete Event</button>
                </form>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-gray-400">No events have been created yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}